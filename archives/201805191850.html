<!DOCTYPE html>
<html lang="en">
<head>
  <title>Python MySQL | 我有一瓶酒，只想跟你喝</title>
  <meta charset="utf-8">
<meta name="description" content="Python MySQL Python DB-API使用流程： 引入 API 模块。 获取与数据库的连接。 执行SQL语句和存储过程。 关闭数据库连接。 Operation # SQL删除记录语句 sql = "DELETE FROM EMPLOYEE WHERE AGE > '%d'" % (20) try: # 执行SQL语句 cursor.execute(sql) # 向数据库提交 db.commit() except: # 发生错误时回滚 db.rollback() Connect to DB #!/usr/bin/python # -*- coding: UTF-8 -*- import MySQLdb # 打开数据库连接 db = MySQLdb.connect("localhost", "testuser", "test123", "TESTDB …"><meta name="author" content="Torikku">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Cache-Control" content="max-age=604800, must-revalidate" />
  <link href="https://torikku.github.io/theme/css/screen.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="https://torikku.github.io/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="https://torikku.github.io/favicon.ico" type="image/x-icon">
  <link href="https://torikku.github.io/" type="application/atom+xml" rel="alternate" title="我有一瓶酒，只想跟你喝 ATOM Feed" />
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
  <div class="logo"><a href="https://torikku.github.io">我有一瓶酒，只想跟你喝</a></div>
  <div class="small">Torikku's life</div>
    <div class="nav">
  <li><a href="https://torikku.github.io/archives/">那一天</a></li>
  <li><a href="https://torikku.github.io/about/">关于（建设中）</a></li>
    </div>
</div>    <div id="main">
<h2><a href="category/{slug}.html/archives/201805191850.html">Python MySQL</a></h2>
<h5><i class="icon-feather"></i> 2018年05月19日(星期六)
<i class="icon-bookmarks"></i>
</h5>

<h1>Python MySQL</h1>
<p>Python DB-API使用流程：</p>
<ul>
<li>引入 API 模块。</li>
<li>获取与数据库的连接。</li>
<li>执行SQL语句和存储过程。</li>
<li>关闭数据库连接。</li>
</ul>
<h2>Operation</h2>
<div class="highlight"><pre><span></span><span class="c1"># SQL删除记录语句</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM EMPLOYEE WHERE AGE &gt; &#39;</span><span class="si">%d</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
   <span class="c1"># 执行SQL语句</span>
   <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
   <span class="c1"># 向数据库提交</span>
   <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
   <span class="c1"># 发生错误时回滚</span>
   <span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div>


<h2>Connect to DB</h2>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">MySQLdb</span>

<span class="c1"># 打开数据库连接</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;testuser&quot;</span><span class="p">,</span> <span class="s2">&quot;test123&quot;</span><span class="p">,</span> <span class="s2">&quot;TESTDB&quot;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span> <span class="p">)</span>

<span class="c1"># 使用cursor()方法获取操作游标 </span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># 使用execute方法执行SQL语句</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT VERSION()&quot;</span><span class="p">)</span>

<span class="c1"># 使用 fetchone() 方法获取一条数据</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

<span class="k">print</span> <span class="s2">&quot;Database version : </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">data</span>

<span class="c1"># 关闭数据库连接</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<h2>Create Table in DB</h2>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">MySQLdb</span>

<span class="c1"># 打开数据库连接</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;testuser&quot;</span><span class="p">,</span> <span class="s2">&quot;test123&quot;</span><span class="p">,</span> <span class="s2">&quot;TESTDB&quot;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span> <span class="p">)</span>

<span class="c1"># 使用cursor()方法获取操作游标 </span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># 如果数据表已经存在使用 execute() 方法删除表。</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DROP TABLE IF EXISTS EMPLOYEE&quot;</span><span class="p">)</span>

<span class="c1"># 创建数据表SQL语句</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CREATE TABLE EMPLOYEE (</span>
<span class="s2">         FIRST_NAME  CHAR(20) NOT NULL,</span>
<span class="s2">         LAST_NAME  CHAR(20),</span>
<span class="s2">         AGE INT,  </span>
<span class="s2">         SEX CHAR(1),</span>
<span class="s2">         INCOME FLOAT )&quot;&quot;&quot;</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

<span class="c1"># 关闭数据库连接</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<h2>Insert Line into Table</h2>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">MySQLdb</span>

<span class="c1"># 打开数据库连接</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;testuser&quot;</span><span class="p">,</span> <span class="s2">&quot;test123&quot;</span><span class="p">,</span> <span class="s2">&quot;TESTDB&quot;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span> <span class="p">)</span>

<span class="c1"># 使用cursor()方法获取操作游标 </span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># SQL 插入语句</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO EMPLOYEE(FIRST_NAME,</span>
<span class="s2">         LAST_NAME, AGE, SEX, INCOME)</span>
<span class="s2">         VALUES (&#39;Mac&#39;, &#39;Mohan&#39;, 20, &#39;M&#39;, 2000)&quot;&quot;&quot;</span>
<span class="k">try</span><span class="p">:</span>
   <span class="c1"># 执行sql语句</span>
   <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
   <span class="c1"># 提交到数据库执行</span>
   <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
   <span class="c1"># Rollback in case there is any error</span>
   <span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="c1"># 关闭数据库连接</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<h2>Quely in Table</h2>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">MySQLdb</span>

<span class="c1"># 打开数据库连接</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;testuser&quot;</span><span class="p">,</span> <span class="s2">&quot;test123&quot;</span><span class="p">,</span> <span class="s2">&quot;TESTDB&quot;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span> <span class="p">)</span>

<span class="c1"># 使用cursor()方法获取操作游标 </span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># SQL 查询语句</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM EMPLOYEE </span><span class="se">\</span>
<span class="s2">       WHERE INCOME &gt; &#39;</span><span class="si">%d</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
   <span class="c1"># 执行SQL语句</span>
   <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
   <span class="c1"># 获取所有记录列表</span>
   <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
   <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
      <span class="n">fname</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">lname</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">age</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">sex</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">income</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
      <span class="c1"># 打印结果</span>
      <span class="k">print</span> <span class="s2">&quot;fname=</span><span class="si">%s</span><span class="s2">,lname=</span><span class="si">%s</span><span class="s2">,age=</span><span class="si">%d</span><span class="s2">,sex=</span><span class="si">%s</span><span class="s2">,income=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> \
             <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">lname</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">sex</span><span class="p">,</span> <span class="n">income</span> <span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
   <span class="k">print</span> <span class="s2">&quot;Error: unable to fecth data&quot;</span>

<span class="c1"># 关闭数据库连接</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<h2>Update Line in Table</h2>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">MySQLdb</span>

<span class="c1"># 打开数据库连接</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;testuser&quot;</span><span class="p">,</span> <span class="s2">&quot;test123&quot;</span><span class="p">,</span> <span class="s2">&quot;TESTDB&quot;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span> <span class="p">)</span>

<span class="c1"># 使用cursor()方法获取操作游标 </span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># SQL 更新语句</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;UPDATE EMPLOYEE SET AGE = AGE + 1 WHERE SEX = &#39;</span><span class="si">%c</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
   <span class="c1"># 执行SQL语句</span>
   <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
   <span class="c1"># 提交到数据库执行</span>
   <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
   <span class="c1"># 发生错误时回滚</span>
   <span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="c1"># 关闭数据库连接</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<h2>Delete Line in Table</h2>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>

<span class="kn">import</span> <span class="nn">MySQLdb</span>

<span class="c1"># 打开数据库连接</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;testuser&quot;</span><span class="p">,</span> <span class="s2">&quot;test123&quot;</span><span class="p">,</span> <span class="s2">&quot;TESTDB&quot;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span> <span class="p">)</span>

<span class="c1"># 使用cursor()方法获取操作游标 </span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># SQL 删除语句</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM EMPLOYEE WHERE AGE &gt; &#39;</span><span class="si">%d</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
   <span class="c1"># 执行SQL语句</span>
   <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
   <span class="c1"># 提交修改</span>
   <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
   <span class="c1"># 发生错误时回滚</span>
   <span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="c1"># 关闭连接</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

<p align="center"><a href="#">on the top</a></p>
    </div>
</div>
<div id="footer-wrapper">
<ul class="footer">
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2014&nbsp;::</li>
    <li class="footer"><a href="https://torikku.github.io">我有一瓶酒，只想跟你喝 </a>&nbsp;::</li>
    <li class="footer">powered by <a href="https://github.com/getpelican">pelican</a>&nbsp;::</li>
    <li class="footer"><a href="http://creativecommons.org/licenses/by-nc/3.0/deed.ru">CC BY-NC</a></li>
</ul>
</div></body>
</html>